import{_ as q}from"./AdminLayout.908ec7b8.js";import{q as A}from"./index.aef8423a.js";import{_ as F}from"./_plugin-vue_export-helper.cdc0426e.js";import{U as N}from"./UploadOutlined.d3366d82.js";import{R as B}from"./RestFilled.b4429dae.js";import{N as y,C as n,o as d,c as v,w as s,a as g,b as l,f as i,d as c,t as b,F as x,e as C}from"./app.505072c8.js";import"./UserOutlined.870741e4.js";import"./AppstoreOutlined.e053d997.js";const D={components:{AdminLayout:q,UploadOutlined:N,RestFilled:B,quillEditor:A},props:["messageCategories","messages","members"],data(){return{modal:{isOpen:!1,data:{},title:"Modal",mode:""},pagination:{total:this.messages.total,current:this.messages.current_page,pageSize:this.messages.per_page},filter:{},columns:[{title:"\u5206\u985E",dataIndex:"category",width:80},{title:"\u6A19\u984C",dataIndex:"title"},{title:"\u767C\u4EF6\u4EBA",dataIndex:"sender",width:120},{title:"\u6536\u4EF6\u4EBA",dataIndex:"receiver",width:120},{title:"\u64CD\u4F5C",dataIndex:"operation",key:"operation",width:200}],rules:{field:{required:!0},label:{required:!0}},validateMessages:{required:"\u8ACB\u8F93\u5165${label}",types:{email:"${label} \u4E0D\u662F\u6B63\u78BA\u7684\u90F5\u7BB1\u683C\u5F0F",number:"${label} \u4E0D\u662F\u6B63\u78BA\u7684\u6578\u5B57\u683C\u5F0F"},number:{range:"${label} \u5FC5\u9808\u5728${min}\u548C${max}\u4E4B\u9593"}},labelCol:{style:{width:"150px"}}}},created(){},methods:{createRecord(o){this.modal.data={},this.modal.mode="CREATE",this.modal.isOpen=!0},editRecord(o){this.modal.data={...o},this.modal.mode="EDIT",this.modal.isOpen=!0},storeRecord(){this.$refs.modalRef.validateFields().then(()=>{this.$inertia.post(route("admin.messages.store"),this.modal.data,{onSuccess:o=>{this.modal.isOpen=!1,y.success("\u65B0\u589E\u6210\u529F")},onError:o=>{console.log(o)}})}).catch(o=>{console.log(o)})},updateRecord(){this.$refs.modalRef.validateFields().then(()=>{this.modal.data._method="PATCH",this.$inertia.post(route("admin.messages.update",this.modal.data.id),this.modal.data,{onSuccess:o=>{this.modal.isOpen=!1,y.success("\u4FEE\u6539\u6210\u529F")},onError:o=>{console.log(o)}})}).catch(o=>{console.log("error",o)})},deleteRecord(o){this.$inertia.delete("/admin/messages/"+o,{onSuccess:e=>{y.success("\u522A\u9664\u6210\u529F"),console.log(e)},onError:e=>{alert(e.message)}})},onPaginationChange(o,e,u){this.$inertia.get(route("admin.messages.index"),{page:o.current,per_page:10,filter:"namejose"},{onSuccess:f=>{console.log(f)},onError:f=>{console.log(f)}})}}},M={class:"p-8 pt-8"},V={class:"flex pb-2"},L=g("div",{class:"flex-auto w-1/2 font-semibold text-xl text-gray-800 truncate whitespace-nowrap"}," \u901A\u4FE1\u7BA1\u7406 ",-1),P={class:"flex-auto w-1/2 text-right"},j={class:"card drop-shadow-md pt-4"},z={key:0,class:"space-x-2"},H={key:0},G={key:1};function J(o,e,u,f,t,r){const p=n("a-button"),w=n("a-popconfirm"),E=n("a-table"),k=n("a-select"),_=n("a-form-item"),R=n("a-input"),I=n("quill-editor"),U=n("a-form"),S=n("a-modal"),O=n("AdminLayout");return d(),v(O,{title:"Dashboard"},{default:s(()=>[g("div",M,[g("div",V,[L,g("div",P,[l(p,{type:"primary",class:"!rounded",onClick:e[0]||(e[0]=a=>r.createRecord())},{default:s(()=>[i("\u65B0\u589E\u901A\u4FE1")]),_:1})])]),g("div",j,[l(E,{dataSource:u.messages.data,columns:t.columns,pagination:t.pagination,onChange:r.onPaginationChange,ref:"dataTable"},{bodyCell:s(({column:a,text:T,record:m,index:K})=>[a.dataIndex=="operation"?(d(),c("div",z,[l(p,{onClick:h=>r.editRecord(m)},{default:s(()=>[i("\u4FEE\u6539")]),_:2},1032,["onClick"]),l(w,{title:"\u662F\u5426\u78BA\u5B9A\u522A\u9664\u9019\u500B\u901A\u4FE1","ok-text":"\u662F","cancel-text":"\u5426",onConfirm:h=>r.deleteRecord(m.id)},{default:s(()=>[l(p,null,{default:s(()=>[i("\u522A\u9664")]),_:1})]),_:2},1032,["onConfirm"])])):a.dataIndex=="category"?(d(),c(x,{key:1},[i(b(u.messageCategories.find(h=>h.value==T).label),1)],64)):a.dataIndex=="receiver"?(d(),c(x,{key:2},[m.category=="personal"&&m.received_member?(d(),c("p",H,b(m.received_member.display_name),1)):(d(),c("p",G,"--"))],64)):(d(),c(x,{key:3},[i(b(m[a.dataIndex]),1)],64))]),_:1},8,["dataSource","columns","pagination","onChange"])]),l(S,{visible:t.modal.isOpen,"onUpdate:visible":e[8]||(e[8]=a=>t.modal.isOpen=a),title:t.modal.title,width:"60%"},{footer:s(()=>[t.modal.mode=="EDIT"?(d(),v(p,{key:"Update",type:"primary",onClick:e[6]||(e[6]=a=>r.updateRecord())},{default:s(()=>[i("Update")]),_:1})):C("",!0),t.modal.mode=="CREATE"?(d(),v(p,{key:"Store",type:"primary",onClick:e[7]||(e[7]=a=>r.storeRecord())},{default:s(()=>[i("Add")]),_:1})):C("",!0)]),default:s(()=>[l(U,{ref:"modalRef",model:t.modal.data,name:"Teacher","label-col":{span:4},"wrapper-col":{span:20},autocomplete:"off",rules:t.rules,"validate-messages":t.validateMessages},{default:s(()=>[l(_,{label:"\u5206\u985E",name:"category"},{default:s(()=>[l(k,{value:t.modal.data.category,"onUpdate:value":e[1]||(e[1]=a=>t.modal.data.category=a),options:u.messageCategories},null,8,["value","options"])]),_:1}),t.modal.data.category=="personal"?(d(),v(_,{key:0,label:"\u6536\u4EF6\u4EBA",name:"receiver"},{default:s(()=>[l(k,{value:t.modal.data.receiver,"onUpdate:value":e[2]||(e[2]=a=>t.modal.data.receiver=a),options:u.members,"field-names":{label:"display_name",value:"id"}},null,8,["value","options"])]),_:1})):C("",!0),l(_,{label:"\u767C\u4EF6\u4EBA",name:"sender"},{default:s(()=>[l(R,{value:t.modal.data.sender,"onUpdate:value":e[3]||(e[3]=a=>t.modal.data.sender=a)},null,8,["value"])]),_:1}),l(_,{label:"\u6A19\u984C",name:"title"},{default:s(()=>[l(R,{value:t.modal.data.title,"onUpdate:value":e[4]||(e[4]=a=>t.modal.data.title=a)},null,8,["value"])]),_:1}),l(_,{label:"\u5167\u5BB9",name:"content"},{default:s(()=>[l(I,{value:t.modal.data.content,"onUpdate:value":e[5]||(e[5]=a=>t.modal.data.content=a),style:{"min-height":"200px"}},null,8,["value"])]),_:1})]),_:1},8,["model","rules","validate-messages"])]),_:1},8,["visible","title"])])]),_:1})}const ae=F(D,[["render",J]]);export{ae as default};
