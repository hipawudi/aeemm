import{_ as q}from"./AdminLayout.b1278d3d.js";import{q as A}from"./index.d0cdfff6.js";import{_ as F}from"./_plugin-vue_export-helper.cdc0426e.js";import{U as L}from"./UploadOutlined.e038a453.js";import{R as z}from"./RestFilled.d8a5daa8.js";import{C as y,D as n,o as i,c as h,w as l,a as u,b as s,f as c,d as _,t as x,F as R,e as b}from"./app.8d6b5d0d.js";import"./UserOutlined.74c238c8.js";import"./AppstoreOutlined.5537e5f8.js";const B={components:{AdminLayout:q,UploadOutlined:L,RestFilled:z,quillEditor:A},props:["messageCategories","messages","members"],data(){return{modal:{isOpen:!1,data:{},title:"Modal",mode:""},pagination:{total:this.messages.total,current:this.messages.current_page,pageSize:this.messages.per_page},filter:{},columns:[{title:"\u5206\u985E",dataIndex:"category",width:80},{title:"\u6A19\u984C",dataIndex:"title"},{title:"\u767C\u4EF6\u4EBA",dataIndex:"sender",width:120},{title:"\u6536\u4EF6\u4EBA",dataIndex:"receiver",width:120},{title:"\u64CD\u4F5C",dataIndex:"operation",key:"operation",width:200}],rules:{field:{required:!0},label:{required:!0}},validateMessages:{required:"\u8ACB\u8F93\u5165${label}",types:{email:"${label} \u4E0D\u662F\u6B63\u78BA\u7684\u90F5\u7BB1\u683C\u5F0F",number:"${label} \u4E0D\u662F\u6B63\u78BA\u7684\u6578\u5B57\u683C\u5F0F"},number:{range:"${label} \u5FC5\u9808\u5728${min}\u548C${max}\u4E4B\u9593"}},labelCol:{style:{width:"150px"}}}},created(){},methods:{createRecord(t){this.modal.data={},this.modal.mode="CREATE",this.modal.isOpen=!0},editRecord(t){this.modal.data={...t},this.modal.mode="EDIT",this.modal.isOpen=!0},storeRecord(){this.$refs.modalRef.validateFields().then(()=>{this.$inertia.post(route("admin.messages.store"),this.modal.data,{preserveState:!1,onSuccess:t=>{this.modal.isOpen=!1,y.success("\u65B0\u589E\u6210\u529F")},onError:t=>{console.log(t)}})}).catch(t=>{console.log(t)})},updateRecord(){this.$refs.modalRef.validateFields().then(()=>{this.modal.data._method="PATCH",this.$inertia.post(route("admin.messages.update",this.modal.data.id),this.modal.data,{preserveState:!1,onSuccess:t=>{this.modal.isOpen=!1,y.success("\u4FEE\u6539\u6210\u529F")},onError:t=>{console.log(t)}})}).catch(t=>{console.log("error",t)})},deleteRecord(t){this.$inertia.delete("/admin/messages/"+t,{preserveState:!1,onSuccess:e=>{y.success("\u522A\u9664\u6210\u529F"),console.log(e)},onError:e=>{alert(e.message)}})},onPaginationChange(t,e,m){this.$inertia.get(route("admin.messages.index"),{page:t.current,per_page:t.pageSize},{onSuccess:v=>{console.log(v)},onError:v=>{console.log(v)}})},filterOption(t,e){return console.log(t),e.name_zh.toLowerCase().indexOf(t.toLowerCase())>=0}}},D={class:"md:p-8 pt-8"},M={class:"flex pb-2"},N=u("div",{class:"flex-auto w-1/2 font-semibold text-xl text-gray-800 truncate whitespace-nowrap"}," \u901A\u4FE1\u7BA1\u7406 ",-1),V={class:"flex-auto w-1/2 text-right"},P={class:"container mx-auto pt-5"},H={class:"bg-white relative shadow rounded-lg overflow-x-auto"},j={key:0,class:"space-x-2"},G={key:0},J={key:1};function K(t,e,m,v,a,d){const p=n("a-button"),S=n("a-popconfirm"),E=n("a-table"),C=n("a-select"),f=n("a-form-item"),w=n("a-input"),O=n("quill-editor"),I=n("a-form"),U=n("a-modal"),T=n("AdminLayout");return i(),h(T,{title:"\u901A\u4FE1\u7BA1\u7406"},{default:l(()=>[u("div",D,[u("div",M,[N,u("div",V,[s(p,{type:"primary",class:"!rounded",onClick:e[0]||(e[0]=o=>d.createRecord())},{default:l(()=>[c("\u65B0\u589E\u901A\u4FE1")]),_:1})])]),u("div",P,[u("div",H,[s(E,{dataSource:m.messages.data,columns:a.columns,pagination:a.pagination,onChange:d.onPaginationChange,ref:"dataTable"},{bodyCell:l(({column:o,record:r})=>{var k;return[o.dataIndex=="operation"?(i(),_("div",j,[s(p,{onClick:g=>d.editRecord(r)},{default:l(()=>[c("\u4FEE\u6539")]),_:2},1032,["onClick"]),s(S,{title:"\u662F\u5426\u78BA\u5B9A\u522A\u9664\u9019\u500B\u901A\u4FE1","ok-text":"\u662F","cancel-text":"\u5426",onConfirm:g=>d.deleteRecord(r.id)},{default:l(()=>[s(p,null,{default:l(()=>[c("\u522A\u9664")]),_:1})]),_:2},1032,["onConfirm"])])):o.dataIndex=="category"?(i(),_(R,{key:1},[c(x(m.messageCategories.find(g=>g.value==r.category).label),1)],64)):o.dataIndex=="receiver"?(i(),_(R,{key:2},[r.category=="member"||r.category=="public"?(i(),_("div",G,x(m.messageCategories.find(g=>g.value==r.category).label),1)):(i(),_("div",J,x((k=r.received_member)!=null?k:"111"),1))],64)):b("",!0)]}),_:1},8,["dataSource","columns","pagination","onChange"])])]),s(U,{visible:a.modal.isOpen,"onUpdate:visible":e[8]||(e[8]=o=>a.modal.isOpen=o),title:a.modal.title,width:"60%"},{footer:l(()=>[a.modal.mode=="EDIT"?(i(),h(p,{key:"Update",type:"primary",onClick:e[6]||(e[6]=o=>d.updateRecord())},{default:l(()=>[c("Update")]),_:1})):b("",!0),a.modal.mode=="CREATE"?(i(),h(p,{key:"Store",type:"primary",onClick:e[7]||(e[7]=o=>d.storeRecord())},{default:l(()=>[c("Add")]),_:1})):b("",!0)]),default:l(()=>[s(I,{ref:"modalRef",model:a.modal.data,name:"Teacher","label-col":{span:4},"wrapper-col":{span:20},autocomplete:"off",rules:a.rules,"validate-messages":a.validateMessages},{default:l(()=>[s(f,{label:"\u5206\u985E",name:"category"},{default:l(()=>[s(C,{value:a.modal.data.category,"onUpdate:value":e[1]||(e[1]=o=>a.modal.data.category=o),options:m.messageCategories},null,8,["value","options"])]),_:1}),a.modal.data.category=="personal"?(i(),h(f,{key:0,label:"\u6536\u4EF6\u4EBA",name:"receiver"},{default:l(()=>[s(C,{value:a.modal.data.receiver,"onUpdate:value":e[2]||(e[2]=o=>a.modal.data.receiver=o),options:m.members,"show-search":"","filter-option":d.filterOption,"field-names":{label:"name_zh",value:"id"}},null,8,["value","options","filter-option"])]),_:1})):b("",!0),s(f,{label:"\u767C\u4EF6\u4EBA",name:"sender"},{default:l(()=>[s(w,{value:a.modal.data.sender,"onUpdate:value":e[3]||(e[3]=o=>a.modal.data.sender=o)},null,8,["value"])]),_:1}),s(f,{label:"\u6A19\u984C",name:"title"},{default:l(()=>[s(w,{value:a.modal.data.title,"onUpdate:value":e[4]||(e[4]=o=>a.modal.data.title=o)},null,8,["value"])]),_:1}),s(f,{label:"\u5167\u5BB9",name:"content"},{default:l(()=>[s(O,{value:a.modal.data.content,"onUpdate:value":e[5]||(e[5]=o=>a.modal.data.content=o)},null,8,["value"])]),_:1})]),_:1},8,["model","rules","validate-messages"])]),_:1},8,["visible","title"])])]),_:1})}const ae=F(B,[["render",K]]);export{ae as default};
